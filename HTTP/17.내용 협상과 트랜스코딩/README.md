이 글은 'HTTP 완벽가이드'라는 책을 읽으면서 제가 이해한 내용을 바탕으로 정리한 글입니다. 
혹시 이 글을 보게 되신다면 비판적인 시각으로 보시는 것을 추천 드립니다.

<img src="http://image.yes24.com/goods/15381085/XL" alt="HTTP 완벽 가이드" style="zoom:67%;" />

---

## 내용 협상과 트랜스 코딩

### 1. 내용 협상 기법

- 서버에 있는 페이지들 중 어떤 것이 클라이언트에게 맞는지 판단하는 세가지 방법이 있음
  - 클라이언트  주도 협상
  - 서버 주도 협상
  - 투명 협상




#### 1. 클라이언트 주도 협상

- 서버에게 있어 가장 쉬운 방법은 서버가 클라이언트의 요청을 받았을 때 가능한 페이지의 목록을 응답으로 돌려주어 클라이언트가 보고 싶은 것을 선택하게 하는 것
- 서버입장에서 가장 구현하기 쉽고 최선이 사본이 선택될 것이지만, 각 페이지에 두번의 요청이 필요하다



#### 2. 서버 주도 협상

- HTTP 서버가 클라이언트에게 보내줄 적절한 응답을 계산하기 위해 사용하는 메커니즘은 다음 두 가지
  - 내용 협상 헤더들을 살펴 봄
  - 내용 협상 헤더 외의 다른 헤더들을 살펴 봄

1. 내용 협상 헤더

   | Accept 관련 헤더 | 엔터티 헤더      |
   | ---------------- | ---------------- |
   | Accept           | Content-Type     |
   | Accept-Language  | Content-Language |
   | Accept-Charset   | Content-Type     |
   | Accept-Encoding  | Content-Encoding |



2. 내용 협상 헤더의 품질 값

   - 클라이언트를 위해 그들의 선호에 대한 풍부한 설명을 품질값(q값)을 이용해 전달할 수 있는 메커니즘을 제공

   ```
   Accept-Languagae : en; q=0.5, fr;q=0.0, nl;q=1.0
   ```

   - q값은 0.0부터 1.0까지의 값을 가질 수 있음

3. 그 외의 헤더들에 의해 결정

   - 서버는 또한 User-Agent와 같은 클라이언트의 다른 요청 헤더들을 이용해 알맞은 요청을 만들어내려고 시도할 수 있음



#### 3. 투명 협상

- 투명 협상은 클라이언트 입장에서 협상하는 중개자 프락시를 둠으로써 클라이언트와의 메시지 교환을 최소화하는 동시에 서버 주도 협상으로 인한 부하를 서버에서 제거
- 서버는 응답에 Vary 헤더를 포함시켜 보냄으로써 중개자에게 내용 협상을 위해 어떤 헤더를 사용하고 있는지 알려줄 수 있음



1. **캐시와 얼터네이트**
   - 캐시는 클라이언트에게 올바른 캐시된 응답을 돌려주기 위해, 서버가 응답을 돌려줄 때 사용했던 의사결정 로직의 상당 부분을 그대로 사용해야 함
   - 캐시는 내용 협상 헤더들을 이용해 가장 잘 맞는 것을 찾아 이용자에게 돌려줌
   - 즉, 투명 협상을 구현하기 위해 캐시는 반드시 캐시된 배리언트와 함께 클라이언트 요청 헤더와 그에 알맞은 서버 응답 헤더 양쪽 모두를 저장해야함



### 3. 트랜스코딩

1. **포맷변환**
   - 포맷 변환은 데이터를 클라이언트가 볼 수 있도록 한 포맷에서 다른 포맷으로 변환 하는 것

2. **정보 합성**
   - 문서에서 정보의 요점을 추출하는 것을 정보 합성이라고 하는데, 이는 트랜스코딩과정에서 유용할 수 있음
     - 광고 및 로고 제거에 활용 가능
     - 문서 요약에 유용

3. **콘텐츠 주입**
   - 특정 사용자를 대상으로 광고를 삽입 할 때도 사용 가능
   -  특정 사용자를 대상으로 하는 광고를 효과적으로 삽입하기 위해 동적으로 이루어짐

4. **트랜스코딩 vs 정적으로 미리 생성**
   - 트랜스코딩의 대안은 웹 서버에서 웹 페이지의 여러 가지 사본을 만드는 것
     - 현실 적인 기법이 되기 힘듬


