이 글은 'HTTP 완벽가이드'라는 책을 읽으면서 제가 이해한 내용을 바탕으로 정리한 글입니다. 
혹시 이 글을 보게 되신다면 비판적인 시각으로 보시는 것을 추천 드립니다.

<img src="http://image.yes24.com/goods/15381085/XL" alt="HTTP 완벽 가이드" style="zoom:67%;" />

---

## 클라이언트 식별과 쿠키

### 1. HTTP 헤더

- From 헤더
  - From 헤더로 사용자 식별 가능
  - 악의적인 서버가 이메일 주소를 모으는 경우가 있어 From 헤더를 보내는 브라우저는 많지 않음
- User-Agent
  - 사용자가 사용하는 브라우저의 이름과 버전 정보, 어떤 경우에는 운영체제에 대한 정보까지 서버에 알려줌
  - 속성에 맞추어 콘텐츠를 최적화하는데 유용함
  - Referer 헤더
    - 사용자가 현재 페이지로 유입하게 한 웹 페이지의 URL을 가리킴
    - 사용자가 이전에 어떤 페이지를 방문했는지 알려줌



### 2. 클라이언트 IP주소

- 클라이언트 IP주소는 보통 HTTP 헤더에 없지만 웹 서버는 HTTP 요청을 보내는 반대쪽 TCP 커넥션의 IP 주소를 알아낼 수 있음

- IP 주소를 통한 사용자 식별은 아래와 같은 약점을 가지고 있음

  - 사용하는 컴퓨터를 가르키기 때문에 공용컴퓨터에 사용 불가
  - ISP(인터넷 서비스 제공자)는 동적으로 사용자 IP 주소 할당
  - NAT 장비들은 클라이언트의 실제 IP주소를 방화벽 뒤로 숨기고 방화벽 IP주소로 변환
  - HTTP 프락시와 게이트웨이는 클라이언트 IP주소 대신 프락시 서버의 IP주소를 제공

  

  

### 3. 사용자 로그인

- 서버가 사용자 로그인을 요구한다면 Authorization  헤더에 정보를 기술하여 보낼  수 있음



### 4. 뚱뚱한 URL

- 사용자의 URL마다 버전을 기술하여 사용자를 식별하고 추적가능
- 단점
  - URL 이 길어짐
  - URL을 공유할 수 없어짐
  - 캐시 사용 불가 
    - 매번 URL이 달라지기 때문
  - 서버 부하 가중
  - 이탈
  - 세션 간 지속성 부재



### 쿠키

- 쿠키는 사용자를 식별하고 유지하는 방식 중에서 현재까지 가장 널리 사용하는 방식

1. **쿠키의 타입**

   1. 세션 쿠키
      - 사용자가 부라우저를 탐색할 때, 관련한 설정과 선호 사항들을 저장하는 임시 쿠키
      - 사용자가 브라우저를 닫으면 삭제됨
   2. 지속 쿠키
      - 삭제되지 않고 더 길게 유지가능
      - 디스크에 저장되어, 브라우저를 닫거나 재시작 하더라도 남아 있음

   - 두 쿠키의 차이점은 파기되는 시점 뿐임

2. **쿠키의 동작 방법**

   - 서버에서 Set-Cookie 혹은 Set-Cookie2(확장 헤더) 같은 HTTP 응답 헤더에 기술되어 사용자에게 전달됨
   - 브라우저는 전달된 쿠키를 저장
   - **쿠키 속성**
     - 서버는 쿠키를 생성할 때 쿠키의 속성을 기술해서 제어 할 수 있도록 함
     - Path 속성
       - URL 경로의 앞부분을 가르키는 Path 속성을 기술하여 그 경로에 속하는 페이지에만 전달

3. **쿠키와 캐싱**

   - 쿠키 트랜잭션과 관련된 문서를 캐싱하는 것은 주의해야함

   - 이전 사용자의 쿠키가 다른 사용자에게 할당돼버리거나, 노출되는 상황이 일어날 수 있음

   - 캐시 할 때 주의할 점

     - 캐시되지 말아야한다면 표시

       - 만약 Cookie 헤더를 제외하고 캐시해도 된다면 아래와 같이 표기
       - ```Cache-Control : no-cache="Set-Cookie"```

     - Set-Cookie 헤더를 캐시 하는 것에 유의

       - ```Cache-Control : must-revalidate, max-age=0```
       - 다음과 같은 헤더를 문서에 추가함으로써 재 검사가 일어나게 함

     - Cookie 헤더를 가지고 있는 요청을 주의

       - 요청이 Cookie 헤더와 함께 호면, 결과 콘텐츠가 개인정보를 담고 있을 수 있음
       - 개인 정보는 캐시되지 않도록 표시

       



