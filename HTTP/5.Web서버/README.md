이 글은 'HTTP 완벽가이드'라는 책을 읽으면서 제가 이해한 내용을 바탕으로 정리한 글입니다. 
혹시 이 글을 보게 되신다면 비판적인 시각으로 보시는 것을 추천 드립니다.

<img src="http://image.yes24.com/goods/15381085/XL" alt="HTTP 완벽 가이드" style="zoom:67%;" />

---

## 웹 서버

### 웹 서버란

#### 1. 다채로운 웹 서버

1. 웹 서버 구현
   - 웹 서버는 HTTP 및 그와 관련되 TCP 처리를 구현한 것
   - 웹 서버는 HTTP 프로토콜을 구현하고, 웹 리소스를 관리하고, 웹 서버 관리 기능을 제공
2. 다목적 소프트웨어 웹 서버
   - 다목적 소프트웨어 웹 서버는 네트워크에 연결된 표준 컴퓨터 시스템에서 동작
3. 임베디드 웹 서버
   - 일반 소비자용 제품에 내장될 목적으로 만들어진 작은 웹 서버



### 웹 서버 수행 과정

#### 1. 클라이언트 커넥션 수락

1. **새 커넥션 다루기**
   - 클라이언트가 웹 서벅에 TCP 커넥션을 요청하면, 웹 서버는 그 커넥션을 맺고 TCP 커넥션에서 IP 주소를 추출하여 커넥션 맞은편에 어떤 클라이언트가 있는지 확인
   - 웹 서버는 어떤 커넥션이든 마음대로 거절하거나 즉시 닫을 수 있음
2. **클라이언트 호스트 명 식별**
   - 대부분의; 웹 서버는 '역방향 DNS'를 사용하여 클라이언트의 IP주소를 클라이언트의 호스트 명으로 변환하도록 설정
   - 구체적인 접근 제어와 로깅을 위해 사용할 수 있음
   - 이 과정에서 시간이 많이 걸릴 수 있어 웹 트랜잭션을 느려지게 할 수 있음
3. **ident를 통해 클라이언트 사용자 알아내기**
   - 몇몇 웹 서버는 IETF ident 프로토콜을 지원
   - ident 프로토콜은 서버에게 어떤 사용자 이름이 http 커넥션을 초기화했는지 찾아 낼 수 있게 해줌



#### 2. 요청 메시지 수신

- 요청줄을 파싱하여 요청 메서드, 지정된 리소스의 식별자(URI), 버전 번호를 찾음
- 메시지의 헤더를 읽음
- 요청의 본문이 있다면, 읽어 들임



1. **메시지의 내부 표현**
2. **커넥션 입력/출력 처리 아키텍저**
   - 단일 스레드 웹 서버
     - 한번에 하나씩 요청을 처리함
     - 구현은 간단하지만 비효율
   - 멀티프로세스와 멀티스레드 웹 서버
     - 멀티프로세스와 멀티스레드 웹 서버는 여러 요청을 동시에 처리하기 위해 여러개의 프로세스 혹은 고효율 스레드를 할당
   - 다중 I/O 서버
     - 대량의 커넥션을 지원하기 위해, 많은 웹 서버는 다중 아키텍처 채택
     - 모든 커넥션은 동시에 그 활동을 감시 당함
     - 커넥션의 상태가 바뀌면, 그 커넥션에 대해 작은 양의 처리 수행. 그 처리가 완려되면, 커넥션은 다음번 상태 변경을 위해 열린 커넥션 목록으로 들어감
     - 어떤 커넥션에 대해 작업을 수행하는 것은 그 커넥션에 실제로 해야 할 일이 있을 때 뿐이기 때문에, 스레드와 프로세스는 유휴 상태의 커넥션에 리소스를 낭비하지 않음
   - 다중 멀티스레드 웹
     - 일부 CPU가 여러개 있는 컴퓨터는 멀티스레딩과 다중화를 결합



#### 3. 요청 처리

- 웹 서버가 요청을 받으면, 서버는 요청으로부터 메서드, 리소스, 헤더, 본문을 얻어내어 처리

#### 4. 리소스의 매핑과 접근

- 웹 서버가 클라이언트에 콘텐츠를 전달하려면, 그전에 요청 메시지의 URI에 대응하는 알맞은 콘텐츠나 콘텐츠 생성기를 웹 서버에서 찾아서 그 원천을 식별해야함

1. **Docroot**

   - **Docroot**
     - 요청 URL를 웹 서버의 파일 시스템 안에 있는 파일 이름으로 사용
     - 가장 단순한 형태
   - **가상 호스팅된 docroot**
     - 각 사이트에 그들만의 분리된 문서 루트를 주는 방법으로 한 웹 서버에서 여러 개의 웹 사이트를 호스팅 함
     - URL나 Host 헤더에서 얻은 IP주소나 호스트 명을 이용해 올바른 문서 루트를 식별
     - 하나의 웹 서버 위에서 두 개의 사이트가 완전히 분리된 콘텐츠를 갖고 호스팅 되도록 할 수 있음

   - **사용자 홈 디렉터리 docroots**

     - 한 대의 웹 서버에서 각자의 개인 웹 사이트를 만들 수 있도록 해줌

     

2. **디렉토리 몽록**
   - 웹 서버는 경로가 파일이 아닌 디렉터리를 가리키는, 디렉터리 URL 에 대한 요청을 받을 수 있음
   - 이 때, 아래와 같은 행동을 취하도록 설정 가능
     - 에러 반환
     - '색인 파일' 반환
     - 디렉터리를 탐색하여 그 내용을 담은 HTML 페이지반환
3. **동적 콘텐츠 리소스 매핑**
   - 웹 서버는 URI를 동적 리소스에 메핑 할 수 있음
4. **서버사이드 인클루드**
5. **접근 제어**



#### 5. 응답 만들기

1. **응답 엔터티**
   - 응답 메시지의 본문이 있다면, 응답 메시지는 주로 다음을 포함
     - 응답 본문의 MIME 타입을 서술하는 Content-Type 헤더
     - 응답 본문의  길이를 서술하는 Content-Length 헤더
     - 실제 응답 본문의 내용
2. **MIME 타입 결정**
   - 웹 서버에게는 응답 본문의 MIME 타입을 결정해야 하는 책임이 있음
   - mime.types
     - 확장자 별 MIME 타입이 담겨 있는 파일 탐색
     - 이런 확장자 기반 타입 연계가 가장 흔한 방법임
   - 매직 타이핑
     - 아파치 웹 서버는 각 파일의 MIME 타입을 알아내기 위해 파일의 내용을 검사해서 해당하는 패턴이 있는지 찾아 볼 수 있음
     - 느리지만, 표준 확장자 없이 이름이 지어진 경우 편리
   - 유형 명시
     - 특정 파일이나 디텍터리 안의 파일들이 어떤 MIME 타입을 갖도록 웹 서버 설정
3. **리다이렉션**
   - 아래와 같은 경우 리다이렉트가 유용할 수 있음
     - 영구히 리소스가 옮겨진 경우
     - 임시로 리소스가 옮겨진 경우
     - URL 증강
     - 부하 균형
     - 친밀한 다른 서버가 있을 때
     - 디렉터리 이름 정규화



#### 6. 응답 보내기

#### 7. 로깅

- 마지막으로 트랜잭션이 완료되었을 때 웹 서버는 트랜잭션이 어떻게 수행되었는지에 대한 로그를 로그파일에 기록

